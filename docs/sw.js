import{precacheAndRoute}from"workbox-precaching";import{registerRoute}from"workbox-routing";import{CacheableResponsePlugin}from"workbox-cacheable-response";import{NetworkFirst,CacheFirst,StaleWhileRevalidate}from"workbox-strategies";import CONFIG from"./config";precacheAndRoute(self.__WB_MANIFEST),registerRoute((({url:e})=>"https://fonts.googleapis.com"===e.origin||"https://fonts.gstatic.com"===e.origin),new CacheFirst({cacheName:"google-fonts"})),registerRoute((({url:e})=>"https://cdnjs.cloudflare.com"===e.origin||e.origin.includes("fontawesome")),new CacheFirst({cacheName:"fontawesome"})),registerRoute((({url:e})=>"https://ui-avatars.com"===e.origin),new CacheFirst({cacheName:"avatars-api",plugins:[new CacheableResponsePlugin({statuses:[0,200]})]})),registerRoute((({request:e,url:t})=>new URL(CONFIG.BASE_URL).origin===t.origin&&"image"!==e.destination),new NetworkFirst({cacheName:"story-api"})),registerRoute((({request:e,url:t})=>new URL(CONFIG.BASE_URL).origin===t.origin&&"image"===e.destination),new StaleWhileRevalidate({cacheName:"story-api-images"})),registerRoute((({url:e})=>e.origin.includes("maptiler")),new CacheFirst({cacheName:"maptiler-api"})),self.addEventListener("push",(e=>{let t={};try{t=e.data?e.data.json():{}}catch{}const i=t.title||"Story berhasil dibuat",o=t.options?.body||(t.description?`Anda telah membuat story baru dengan deskripsi: ${t.description}`:"Anda telah membuat story baru."),a=t.storyId||t.id||t.data?.storyId||t.data?.id,r={body:o,icon:"/icons/icon-192.png",tag:"story-created",renotify:!0,data:{url:t.url||t.data?.url||(a?`#/stories?focus=${encodeURIComponent(a)}&hl=1`:"#/stories")}};e.waitUntil(self.registration.showNotification(i,r))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification.data?.url||"#/stories",i=new URL(self.registration.scope),o=new URL(t,i).href;e.waitUntil((async()=>{const e=await self.clients.matchAll({type:"window",includeUncontrolled:!0});let t=e.find((e=>e.url.startsWith(self.registration.scope)));if(t||(t=e[0]),t){try{await t.navigate(o)}catch{t.postMessage({type:"OPEN_DETAIL",url:o})}await t.focus()}else await self.clients.openWindow(o)})())}));